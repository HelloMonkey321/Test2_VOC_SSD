# Test2_VOC_SSD
### 期中作业实验2（SSD）  
##### （1）先验框匹配  
在训练过程中，首要任务是确定训练图片中的真实目标（ground truth）与哪个先验框相匹配，以便相应的先验框能够预测它们。在Yolo算法中，真实目标的中心落在某个单元格内时，与该单元格中与其交并比（IOU）最大的先验框相匹配，并由该先验框负责预测该真实目标。然而，在SSD算法中，匹配真实目标的先验框有两个主要原则。首先，对于每个真实目标，在图片中找到与其IOU最大的先验框，并将其匹配，这样可以确保每个真实目标一定与某个先验框匹配。通常将与真实目标匹配的先验框称为正样本（实际上应该是与先验框对应的预测框，但由于一一对应的关系，我们采用这个称呼）。反之，如果一个先验框未与任何真实目标匹配，则该先验框被视为负样本，即与背景匹配。一个图片中真实目标的数量通常较少，而先验框的数量很多。如果仅按照第一个原则进行匹配，很多先验框将成为负样本，导致正负样本极度不平衡，因此需要第二个原则。第二个原则是：对于剩余未匹配的先验框，如果某个真实目标的IOU大于某个阈值（通常为0.5），则将该先验框与该真实目标进行匹配。这意味着某个真实目标可能与多个先验框匹配，这是允许的。然而，反过来则不行，因为一个先验框只能匹配一个真实目标。如果多个真实目标与某个先验框的IOU大于阈值，则该先验框只与IOU最大的那个真实目标进行匹配。第二个原则必须在第一个原则之后进行。仔细考虑一下这种情况：如果某个真实目标的最大IOU小于阈值，但其所匹配的先验框与另一个真实目标的IOU大于阈值，那么该先验框应该与哪个真实目标匹配？答案应该是前者，因为我们首先要确保某个真实目标一定有一个先验框与之匹配。然而，这种情况基本上可以认为是不存在的。由于先验框的数量很多，某个真实目标的最大IOU肯定大于阈值，因此只实施第二个原则就足够了。在TensorFlow版本中，只实施了第二个原则，但在PyTorch版本中，两个原则都得到了实施。下图为匹配示意图，其中绿色方框表示真实目标（ground truth），红色方框表示先验框，FP表示负样本，TP表示正样本。  
##### （2）损失函数  
损失函数定义为位置误差（locatization loss, loc）与置信度误差（confidence loss, conf）的加权和。  
##### （3）数据扩增  
采用数据扩增（Data Augmentation）可以提升SSD的性能，主要采用的技术有水平翻转（horizontal flip），随机裁剪加颜色扭曲（random crop & color distortion），随机采集块域（Randomly sample a patch）（获取小目标训练样本）。
##### （4）预测  
对于每个预测框，首先根据类别置信度确定其类别（置信度最大者）与置信度值，并过滤掉属于背景的预测框；然后根据置信度阈值过滤掉阈值较低的预测框；对于留下的预测框进行解码，根据先验框得到其真实的位置参数（解码后一般还需要做clip，防止预测框位置超出图片）；解码之后，一般需要根据置信度进行降序排列，然后仅保留top-k个预测框；最后进行NMS算法，过滤掉重叠度较大的预测框；最后剩余的预测框为检测结果。

 

